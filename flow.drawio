<mxfile host="app.diagrams.net" modified="2020-10-15T02:24:03.998Z" agent="5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36" etag="fIvt2DXgQ5Ir3SgVjYGQ" version="13.8.0" type="github">
  <diagram id="jeHmpw0TtRaYDynAjy10" name="Page-1">
    <mxGraphModel dx="1167" dy="653" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="1654" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="PwdDut0FefblpQdD9I8p-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1.003;entryY=0.446;entryDx=0;entryDy=0;entryPerimeter=0;fillColor=#f8cecc;strokeColor=#b85450;" edge="1" parent="1" source="oKsZvAFN4aBbrpxNf6T7-8" target="oKsZvAFN4aBbrpxNf6T7-34">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-8" value="master" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="950" y="400" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-28" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="oKsZvAFN4aBbrpxNf6T7-9" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="950" y="430" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" source="oKsZvAFN4aBbrpxNf6T7-9" target="oKsZvAFN4aBbrpxNf6T7-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-46" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0;exitDx=0;exitDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="oKsZvAFN4aBbrpxNf6T7-9" target="oKsZvAFN4aBbrpxNf6T7-34" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-9" value="release_20201012&lt;br&gt;部署预发" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="720" y="400" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-10" value="test分支&lt;br&gt;测试环境测试" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="80" y="510" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-11" value="dev分支&lt;br&gt;开发环境测试" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="80" y="280" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="oKsZvAFN4aBbrpxNf6T7-12" target="oKsZvAFN4aBbrpxNf6T7-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="oKsZvAFN4aBbrpxNf6T7-12" target="oKsZvAFN4aBbrpxNf6T7-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="oKsZvAFN4aBbrpxNf6T7-12" target="oKsZvAFN4aBbrpxNf6T7-9" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="780" y="310" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-12" value="&lt;span style=&quot;color: rgb(36 , 41 , 46) ; font-family: , , &amp;#34;segoe ui&amp;#34; , &amp;#34;helvetica&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif , &amp;#34;apple color emoji&amp;#34; , &amp;#34;segoe ui emoji&amp;#34; ; font-size: 16px ; text-align: left ; background-color: rgb(255 , 255 , 255)&quot;&gt;从master拉出feature_1&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="380" y="280" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="oKsZvAFN4aBbrpxNf6T7-13" target="oKsZvAFN4aBbrpxNf6T7-11" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="285" y="280" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="oKsZvAFN4aBbrpxNf6T7-13" target="oKsZvAFN4aBbrpxNf6T7-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-13" value="&lt;span style=&quot;color: rgb(36 , 41 , 46) ; font-size: 16px ; text-align: left ; background-color: rgb(255 , 255 , 255)&quot;&gt;从master拉出&lt;/span&gt;&lt;span style=&quot;color: rgb(36 , 41 , 46) ; font-family: , , &amp;#34;segoe ui&amp;#34; , &amp;#34;helvetica&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif , &amp;#34;apple color emoji&amp;#34; , &amp;#34;segoe ui emoji&amp;#34; ; font-size: 16px ; text-align: left ; background-color: rgb(255 , 255 , 255)&quot;&gt;feature_2&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="380" y="510" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="oKsZvAFN4aBbrpxNf6T7-14" target="oKsZvAFN4aBbrpxNf6T7-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-14" value="local_1" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="350" y="450" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-17" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="oKsZvAFN4aBbrpxNf6T7-15" target="oKsZvAFN4aBbrpxNf6T7-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-15" value="local_2" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="460" y="450" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-18" value="多人合作本地&lt;br&gt;分支rebase&lt;br&gt;整理commit" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="300" y="395" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-19" value="rebase" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="500" y="410" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-31" value="&lt;font color=&quot;#ff0000&quot;&gt;* 通过&lt;span&gt;revert删除该需求&lt;br&gt;* 通过cherry-pick或者再次&lt;br&gt;&amp;nbsp; &amp;nbsp;revert重新添加该需求&lt;br&gt;* feature名字与单号关联，&lt;br&gt;&amp;nbsp; 平台化需求上下车操作&lt;br&gt;* 存在问题：&lt;br&gt;1. 谁来操作？出现冲突怎样处理？&lt;/span&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="570" y="430" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-32" value="&lt;font color=&quot;#3333ff&quot;&gt;提MR合并，同时code review（可选）&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="540" y="280" width="220" height="20" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-33" value="&lt;font color=&quot;#3333ff&quot;&gt;提MR合并，同时code review&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="550" y="560" width="170" height="20" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-34" value="进行预发自动化发布：&lt;br&gt;新建svn发布目录，与master或者生产代码进行diff，有差别的文件直接使用release分支的代码进行覆盖，差量代码写入svn发布目录，若目录已存在，则先清空再写入。&lt;br&gt;集成在前端工具集或者在某台机器上统一做。" style="whiteSpace=wrap;html=1;aspect=fixed;align=left;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="830" y="130" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-36" value="发布生产完成&lt;br&gt;合并到master&lt;br&gt;并打tag" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="850" y="444" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-41" value="&lt;font style=&quot;font-size: 16px&quot;&gt;仍存在的问题：&lt;br&gt;1. 假设feature_1与feature_2有冲突，并且同一个版本上线，会导致每当合并到一个环境分支去测试时（dev \ test \ pre）&lt;br&gt;&amp;nbsp; &amp;nbsp; 都需要解决一次冲突，核心影响是，每次合并分支解决冲突，有可能导致代码不一致。&lt;br&gt;* 方案一：&lt;br&gt;&amp;nbsp; 确定同版本上线，合并的时候可以cherry-pick之前解决冲突的commit，最大程度避免由于解决冲突而带来的代码不一致问题&lt;br&gt;* 方案二：&lt;br&gt;&amp;nbsp; 每个分支都有独立的测试环境，那就不会存在分支竞争测试环境的问题，如果两个分支同期上线且有冲突部分，&lt;br&gt;&amp;nbsp; 要么cherry-pick过来测试，要么等到部署预发的时候再集成测试&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="80" y="1140" width="890" height="130" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-42" value="&lt;font style=&quot;font-size: 16px&quot;&gt;核心解决的问题：&lt;br&gt;1.&amp;nbsp;需要手动整理代码，对比代码时，如果大家都对同一个文件进行修改，容易把不是自己的代码覆盖或者无意中整理上线，因为可能自己这个需求&lt;br&gt;已经隔了很长时间才上线，&lt;span&gt;自己都记不清哪些是自己写的哪些是别人写的，本质是因为没有进行不同版本的代码隔离，需要手工凭记忆挑选。&amp;nbsp;&lt;/span&gt;&lt;br&gt;&lt;/font&gt;&lt;div style=&quot;font-size: 16px&quot;&gt;&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;font color=&quot;#00994d&quot; style=&quot;font-size: 16px&quot;&gt;解决方法：使用feature分支隔离代码&lt;/font&gt;&lt;br&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px&quot;&gt;&lt;font style=&quot;font-size: 16px&quot;&gt;2.&amp;nbsp;&lt;span&gt;整理代码时要进行多轮手动对比，第一次跟线上对比，第二次还要跟整理进去的目录进行对比，以防覆盖了别人的代码，而这些手工都很容易出错。&amp;nbsp;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(0 , 153 , 77)&quot;&gt;解决方法：与线上对比参考图上预发自动化发布。由于分支合并时有冲突会暴露，所以不用担心覆盖别人的代码。&lt;/span&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px&quot;&gt;&lt;span style=&quot;color: rgb(0 , 153 , 77)&quot;&gt;&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px&quot;&gt;&lt;font style=&quot;font-size: 16px&quot;&gt;3.&amp;nbsp;&lt;span&gt;上预发时整理代码后，由于目录并不是完整代码，所以要到部署到了预发才知道整理的代码有没有问题&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px&quot;&gt;&lt;font color=&quot;#00994d&quot; style=&quot;font-size: 16px&quot;&gt;&lt;span&gt;解决方法：&lt;/span&gt;&lt;span&gt;分支合并到release，可以本地跑一下这条分支有没有问题先，最后再自动化diff出svn目录。&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px&quot;&gt;&lt;span&gt;&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px&quot;&gt;&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;span&gt;4.&amp;nbsp;&lt;/span&gt;&lt;span&gt;只有自己清楚自己的改动，假设你需要帮你的同事整理代码，根本不知道哪些是这次需要整理的&amp;nbsp;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px&quot;&gt;&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;span&gt;&lt;font color=&quot;#00994d&quot; style=&quot;font-size: 16px&quot;&gt;解决方法：分支合并，分支已经集成了改动的代码&lt;/font&gt;&lt;br&gt;&lt;/span&gt;&lt;span&gt;&amp;nbsp;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="80" y="805" width="1080" height="200" as="geometry" />
        </mxCell>
        <mxCell id="oKsZvAFN4aBbrpxNf6T7-44" value="&lt;font color=&quot;#ff0000&quot;&gt;如果feature分支跨多个版本，&lt;br&gt;需要某种机制保证及时update&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="380" y="245" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="PwdDut0FefblpQdD9I8p-2" value="&lt;font color=&quot;#ff0000&quot;&gt;回滚到某tag版本自动化&lt;br&gt;处理类似，只是代码使用&lt;br&gt;的是某tag版本的代码&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1019" y="310" width="150" height="50" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
